@model Overstag.Models.Account
@{
    Layout = "/Views/_UserLayout.cshtml";
    ViewBag.Title = "Instellingen";
}
<div>
    <h3 class="center-align">Accountinstellingen</h3><br />
    <div>
        <ul class="collapsible">
            <li>
                <div class="collapsible-header"><i class="material-icons">info</i>Persoonlijke informatie</div>
                <div class="collapsible-body col s12 m6 center-align">
                    <h5>Persoonlijke informatie</h5>
                    <table class="center-align responsive-table">
                        <tbody>
                            <tr>
                                <td>
                                    <div class="input-field">
                                        <i class="material-icons prefix">account_circle</i>
                                        <input type="text" class="checkj" id="firstname" placeholder="Voornaam" value="@Model.Firstname" />
                                        <label for="firstname">Voornaam</label>
                                    </div>
                                </td>
                                <td>
                                    <div class="input-field">
                                        <input type="text" class="checkj" id="lastname" placeholder="Achternaam" value="@Model.Lastname" />
                                        <label for="lastname">Achternaam</label>
                                    </div>
                                </td>
                                <td>
                                    <div class="input-field">
                                        <i class="material-icons prefix">email</i>
                                        <input type="text" class="checkj" id="email" placeholder="Emailadres" value="@Model.Email" />
                                        <label for="email">Emailadres</label>
                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <div class="input-field">
                                        <i class="material-icons prefix">home</i>
                                        <input type="text" class="checkj" id="adress" placeholder="Adres + Huisnummer" value="@Model.Adress" />
                                        <label for="adress">Adres + Huisnummer</label>
                                    </div>
                                </td>
                                <td>
                                    <div class="input-field">
                                        <input type="text" class="checkj" id="postalcode" placeholder="Postcode" value="@Model.Postalcode" />
                                        <label for="postalcode">Postcode</label>
                                    </div>
                                </td>
                                <td>
                                    <div class="input-field">
                                        <input type="text" class="checkj" id="residence" placeholder="Woonplaats" value="@Model.Residence" />
                                        <label for="residence">Woonplaats</label>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                    
                    <br />
                    <a class="waves-effect waves-light btn orange center" onclick="M.Collapsible.getInstance($('.collapsible')).close(0);">Annuleren</a>
                    <a class="waves-effect waves-light btn green center" id="savechanges">Wijzigingen opslaan</a>
                </div>
            </li>
            <li>
                <div class="collapsible-header"><i class="material-icons">lock</i>Wachtwoord wijzigen</div>
                <div class="collapsible-body col s12 m6 center-align">
                    <h5>Wachtwoord wijzigen</h5>
                    <div class="input-field">
                        <i class="material-icons prefix">lock</i>
                        <input type="password" class="checki" id="tbpw1" placeholder="Huidig wachtwoord" />
                        <label class="active" for="tbpw1">Huidig wachtword</label>
                    </div>
                    <br />
                    <div class="input-field">
                        <i class="material-icons prefix">lock</i>
                        <input type="password" class="checki" id="tbpw2" placeholder="Nieuw wachtwoord" />
                        <label class="active" for="tbpw2">Nieuw wachtwoord</label>
                    </div>
                    <div class="input-field">
                        <i class="material-icons prefix">lock</i>
                        <input type="password" class="checki" id="tbpw3" placeholder="Nieuw wachtwoord herhalen" />
                        <label class="active" for="tbpw3">Wachtwoord herhalen</label>
                    </div>
                    <span id="pwhelper" style="color: red; visibility: hidden;">Wachtwoorden komen niet overeen</span>
                    <br /><br />
                    <a class="waves-effect waves-light btn orange center" onclick="M.Collapsible.getInstance($('.collapsible')).close(1); $('.checki').val('');">Annuleren</a>
                    <a class="waves-effect waves-light btn green center" id="savepass">Opslaan</a>

                </div>
            </li>
            <li>
                <div class="collapsible-header"><i class="material-icons">person</i>Account</div>
                <div class="collapsible-body col s12 m6 center-align">
                    <h5>Account</h5>
                    <h6>Account sluiten</h6>
                    <p>Wanneer u besluit uw account te sluiten, is het volgende van toepassing: </p>
                    <p>- 1. Al uw persoonlijke gegevens worden uit onze database verwijderd<br />
                    - 2. U kunt op deze website <b>NIET meer inloggen</b><br />
                    - 3. U kunt uzelf <b>NIET meer inschrijven</b> voor een avond<br />
                    - Uiteraard kunt u opnieuw uzelf registreren als u er spijt van krijgt</p><br />
                    <a class="waves-effect waves-light btn green center" onclick="M.Collapsible.getInstance($('.collapsible')).close(2);">Annuleren</a>
                    <a class="waves-effect waves-light btn red center modal-trigger" data-target="delaccount">Account verwijderen</a>
                </div>
            </li>
        </ul>

        <!--Modal-->
        <div id="delaccount" class="modal">
            <div class="modal-content">
                <h4>Weet je zeker dat je je account wilt verwijderen? <b>Deze actie kan niet ongedaan worden gemaakt!!</b></h4>
                <p>Wanneer u besluit uw account te sluiten, is het volgende van toepassing: </p>
                <p>
                    - 1. Al uw persoonlijke gegevens worden uit onze database verwijderd<br />
                    - 2. U kunt op deze website <b>NIET meer inloggen</b><br />
                    - 3. U kunt uzelf <b>NIET meer inschrijven</b> voor een avond<br />
                    - Uiteraard kunt u opnieuw uzelf registreren als u er spijt van krijgt
                </p><br />
            </div>
            <div class="modal-footer">
                <a class="modal-close waves-effect btn green white-text">Nee natuurlijk niet</a>
                <a class="modal-close waves-effect btn orange white-text">Ik wou alleen ff kijken</a>
                <a onclick="User.delaccount()" class="modal-close waves-effect btn red white-text">Ja, toch verwijderen</a>
            </div>
        </div>

    </div>
    <script>
            var User = {
                init: function () {
                    $('#_asetting').addClass('active');
                    $('#_masetting').addClass('active');

                    User.mapEvents();
                },
                mapEvents: function () {
                    $('#savechanges').click(function () {
                        var validate = true;
                        $('.checkj').each(function () {
                            if ($(this).val() == '') {
                                validate = false;
                                return;
                            }
                        });
                        if (validate) {
                            User.savechanges();
                        } else {
                           M.toast({html: 'Vul a.u.b. alle velden in', classes: 'orange'})
                        }
                    });
                    $('#savepass').click(function () {
                        var validate = true;
                        validate = ($('#tbpw2').val() == $('#tbpw3').val());
                        $('.checki').each(function () {
                            if ($(this).val() == '') {
                                validate = false;
                                return;
                            }
                        });
                        if (validate) {
                            User.savepass();
                        } else {
                           M.toast({html: 'Vul a.u.b. alle velden correct in', classes: 'orange'})
                        }
                    });

                    //Detect & check if passwords matches
                    $('#tbpw2').on('keyup',function () {
                        if ($('#tbpw2').val() != $('#tbpw3').val()) {
                            $('#pwhelper').css('visibility', 'visible');
                        } else { $('#pwhelper').css('visibility', 'hidden'); }
                    });

                    $('#tbpw3').on('keyup',function () {
                        if ($('#tbpw3').val() != $('#tbpw2').val()) {
                            $('#pwhelper').css('visibility', 'visible');
                        } else { $('#pwhelper').css('visibility', 'hidden'); }
                    });
                },
                savechanges: function () {
                     var info = {
                         Firstname: $('#firstname').val(),
                         Lastname: $('#lastname').val(),
                         Email: $('#email').val(),
                         Adress: $('#adress').val(),
                         Postalcode: $('#postalcode').val(),
                         Residence: $('#residence').val()
                     };
                     $.post("/User/postInfoChange", { info }, function (response) {
                        if (response.status == 'success') {
                            M.toast({ html: 'Wijzigingen opgeslagen', classes: 'green' });
                            $('.checki').val('');
                            M.Collapsible.getInstance($('.collapsible')).close(0);
                        }
                        else {
                            //status = error
                            M.toast({ html: response.error, classes: 'red' });
                            $('.checki').val('');
                        }
                    }, 'json');
                },
                savepass: function () {
                    $.post("/User/postPasswordChange", { Oldpass: $('#tbpw1').val(), Newpass: $('#tbpw2').val() }, function (response) {
                        if (response.status == 'success') {
                            M.toast({ html: 'Wijzigingen opgeslagen', classes: 'green' });
                            $('.checki').val('');
                            M.Collapsible.getInstance($('.collapsible')).close(1);
                        }
                        else {
                            //status = error
                            M.toast({ html: response.error, classes: 'red' });
                            $('.checki').val('');
                        }
                    }, 'json');

                },
                //THIS IS A VERY DANGEROUS PIECE OF CODE!!!!!!!!!
                delaccount: function () {
                    var pass = prompt('Typ je wachtwoord in om door te gaan');
                    if (confirm('Account verwijderen? Zeker weten?')) {
                        $.post("/User/postDeleteAccount", { Token: '@Model.Token', Password: pass }, function (response) {
                            if (response.status == 'success') {
                                M.toast({ html: 'Account verwijderd', classes: 'green' });
                                localStorage.setItem("logout", true);
                                $(location).attr('href', '/Register/Logoff')
                            }
                            else {
                                M.toast({ html: response.error, classes: 'red' });
                            }
                        }, 'json');

                    }
                }
                //NEVER MISUSE THIS!!!!!!!!!!!!!!

            }

            User.init();
    </script>
</div>

