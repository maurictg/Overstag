@model List<Overstag.Models.NoDB.ISubscription>
@{
    Layout = null;
    System.Globalization.CultureInfo culture = new System.Globalization.CultureInfo("nl-NL");
}
<br />
<h5 class="blue-middle-text center-align">&nbsp;Komende evenementen, onder het voorbehoud van <a href="https://herzienestatenvertaling.nl/teksten/jakobus/4#15" target="_blank">Jakobus 4:15</a></h5>
<table class="responsive-table">
    <thead>
        <tr>
            <th>Wat</th>
            <th>Wanneer</th>
            <th>Omschrijving</th>
            <th>Kosten</th>
            <th>Inschrijven</th>
        </tr>
    </thead>
    <tbody>
        @if (Model.Count() > 0)
        {
            @foreach (var e in Model)
            {
                bool iss = Overstag.Core.General.DateIsPassed(e.Event.When);
                double c = (double)e.Event.Cost;
                <tr>
                    <td>@e.Event.Title</td>
                    <td>@Html.Raw((iss) ? "(<b class=\"red-text\">te laat</b>) " : "")@e.Event.When.ToString("D", culture) om @e.Event.When.ToString("t", culture)</td>
                    <td>@e.Event.Description</td>
                    <td>&euro;@Math.Round(c / 100, 2).ToString("F")</td>
                    @if (e.Subscribed)
                    {
                        <td><a class="btn @Html.Raw((iss)?"red":"green") waves-effect" onclick="Events.Subscribe(@e.Event.Id);">@Html.Raw((iss) ? "Alsnog " : "")Inschrijven</a></td>
                    }
                    else
                    {
                        <td><a class="btn orange waves-effect @Html.Raw((iss)?"disabled":"")" onclick="Events.DoUnsubscribe(@e.Event.Id);">Uitschrijven</a></td>
                    }
                </tr>
            }
        }
        else
        {
            <tr>
                <td colspan="5"><h5>Nog geen activiteiten</h5></td>
            </tr>
        }
    </tbody>
</table>

<script>
    var Events = {
        DoUnsubscribe: function (id) {
            $('#btnunsub').data('id', id);
            M.Modal.getInstance($('#uitschrijven')).open();
        },
        Subscribe: function (id) {
            //Inschrijven
            $.post("/User/postSubscribeEvent", { EventId: id }, function (response) {
                if (response.status == 'success') {
                    M.toast({ html: 'Inschrijving gelukt! Leuk dat je komt!', classes: 'green' });
                    User.loadcontent();
                }
                else {
                    //status = error
                    M.toast({ html: response.error, classes: 'red' });
                }
            }, 'json');
        },
        Unsubscribe: function (id) {
            if (!(id > 0))
                id = $('#btnunsub').data('id');
            //Uitschrijven
            $.post("/User/postDeleteEvent", { EventId: id }, function (response) {
                if (response.status == 'success') {
                    M.toast({ html: 'Successvol uitgeschreven', classes: 'orange' });
                    User.loadcontent();
                }
                else {
                    //status = error
                    M.toast({ html: response.error, classes: 'red' });
                }
            }, 'json');
        },
    }
</script>