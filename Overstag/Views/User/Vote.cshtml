@model List<Overstag.Models.Idea>
@{
    ViewBag.Title = "Vote";
    Layout = "~/Views/_UserLayout.cshtml";
}

<h3>Ideeën voor activiteiten</h3>
<table class="responsive-table">
    <thead>
        <tr>
            <th>Titel</th>
            <th>Omschrijving</th>
            <th>Vote</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var idea in Model)
        {
            <tr>
                <td>
                    <b>@idea.Title</b>
                    <div class="right">
                        <span class="new badge green" data-badge-caption="likes"><b>@idea.Votes.Count(i => i.Upvote==1)</b></span>
                        <span class="new badge red" data-badge-caption="dislikes"><b>@idea.Votes.Count(i => i.Upvote==0)</b></span>
                    </div>
                </td>
                <td>@idea.Description</td>
                <td>
                    @if (idea.Votes.Any(i => i.UserID == ViewBag.UserID))
                    {
                        <a data-id="@idea.Id" class="likebtn btn-floating waves-effect waves-green @Html.Raw((idea.Votes.First(i => i.UserID == ViewBag.UserID).Upvote == 1)?"green":"grey")"><i class="material-icons">thumb_up</i></a>
                        <a data-id="@idea.Id" class="dislikebtn btn-floating waves-effect waves-red @Html.Raw((idea.Votes.First(i => i.UserID == ViewBag.UserID).Upvote == 0)?"red":"grey")"><i class="material-icons">thumb_down</i></a>
                    }
                    else
                    {
                        <a data-id="@idea.Id" class="likebtn btn-floating waves-effect waves-green grey"><i class="material-icons">thumb_up</i></a>
                        <a data-id="@idea.Id" class="dislikebtn btn-floating waves-effect waves-red grey"><i class="material-icons">thumb_down</i></a>
                    }
                </td>
            </tr>
        }
    </tbody>
</table>
<br />
<table class="responsive-table">
    <tr><td colspan="3" class="center-align"><h6 style="font-weight: bold;">Idee toevoegen</h6></td></tr>
    <tr>
        <td>
            <input placeholder="Titel" id="tbtitle" type="text" class="validate">
        </td>
        <td>
            <input placeholder="Omschrijving" id="tbdesc" type="text" class="validate">
        </td>
        <td>
            <a class="waves-effect waves-light btn blue-dark" onclick="Vote.addIdea();">Toevoegen</a>
        </td>
    </tr>
</table>



<div class="fixed-action-btn">
    <a class="btn-floating btn-large blue-dark waves-effect" href="/User/Events">
        <i class="large material-icons">arrow_back</i>
    </a>
</div>

<script>
    var Vote = {
        init: function () {
            $('#_aevent').addClass('active');
            $('#_maevent').addClass('active');
            Vote.mapEvents();
        },
        mapEvents: function () {
            $('.likebtn').click(function() {
                Vote.saveLike($(this).data('id'), 1);
            });
            $('.dislikebtn').click(function() {
                Vote.saveLike($(this).data('id'), 0);
            });
        },
        addIdea: function () {
            if ($('#tbtitle').val() == '' || $('#tbdesc').val() == '') {
                M.toast({ html: 'Vul a.u.b. alle velden in', classes: 'orange' });
            }
            else {
                $.post('/User/Vote/postIdea', { Title: $('#tbtitle').val(), Description: $('#tbdesc').val() }, function (r) {
                    if (r.status == 'success') {
                        window.location.reload();
                    } else {
                        M.toast({ html: r.error, classes: 'red' });
                    }
                },'json');
            }
        },
        saveLike: function (id, like) {
            $.get('/User/Vote/Like/' + id + '/' + like, function (r) {
                if (r.status == 'success') {
                    window.location.reload();
                }else {
                    M.toast({ html: r.error, classes: 'red' });
                    return false;
                }
            }, 'json');
        },
    };

    $(document).ready(function () {
        Vote.init();
    });
</script>