@model string
@{
    ViewBag.Title = "Inloggen bij Overstag";
    ViewBag.Description = "Log in met jouw Overstag Account om je in te schrijven voor onze avonden en om te kunnen stemmen.";
    ViewBag.Keywords = "stichting overstag, overstag rilland, overstag reimerswaal, overstag inloggen, meedoen";
    ViewBag.Canonical = "https://stoverstag.nl/inloggen";
}
<body class="blue-dark" style="height: 100%; vertical-align: middle;">
    <div class="row">
        <div class="row"></div>
        <h2 class="white-text center-align" id="lblmoment">Momentje...</h2>
        <div class="col s12 m8 offset-m2 l6 offset-l3">
            <div class="card rounded" id="logincard" style="display: none">
                <div class="card-content">
                    <h3 class="center-align blue-middle-text">Inloggen</h3>
                    <div class="row">
                        <div class="input-field col s12">
                            <i class="material-icons prefix">mail_outline</i>
                            <input id="Username" class="checki bigger-input" type="text">
                            <label for="Username" id="lUsername">Gebruikersnaam/email</label>
                        </div>
                    </div>
                    <div class="row">
                        <div class="input-field col s12">
                            <i class="material-icons prefix">lock_outline</i>
                            <input id="Password" class="checki bigger-input" type="password">
                            <label for="password" id="lPassword">Wachtwoord</label>
                        </div>
                    </div>
                    <div class="row">
                        <a class="btn btn-large blue-light col s12 waves-effect disabled rounded" id="btnlogin">Inloggen</a>
                    </div>
                    <div class="row">
                        <div class="input-field col s6">
                            <p class="margin left-align">
                                <a href="/Register/Register"><b>Geen account?</b></a>
                            </p>
                        </div>
                        <div class="input-field col s6">
                            <p class="margin right-align">
                                <a class="modal-trigger" href="#" onclick="Login.openMailReset();"><b>Wachtwoord vergeten?</b></a>
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="col s12 m8 offset-m2 l6 offset-l3">
            <div class="card rounded" id="2facard" style="display: none">
                <div class="card-content">
                    <h4 class="center-align blue-middle-text">Tweetrapsauthenticatie</h4>
                    <div class="row">
                        <h6 class="center-align">Open uw 2fa-app en voer de authenticatiecode in</h6>
                        <div class="input-field col s12 m6 offset-m3">
                            <i class="material-icons prefix">lock_outline</i>
                            <input type="number" placeholder="000000" maxlength="6" style="font-size: xx-large" data-length="6" id="2facode">
                        </div>
                    </div>
                    <div class="center-align">
                        <button class="btn waves-effect orange" onclick="Login.cancel2fa();">Annuleren</button>
                        <a href="#!" class="modal-close waves-effect btn modal-trigger" data-target="tfarestore">Code vergeten?</a>
                    </div>
                </div>
            </div>
        </div>

        <div class="col s12 m8 offset-m2 l6 offset-l3">
            <div class="card rounded" id="memailreset" style="display: none">
                <div class="card-content">
                    <h4 class="center-align blue-middle-text">Wachtwoord resetten</h4>
                    <br />
                    <h6>Vul het emailadres in dat gekoppeld is aan uw account</h6>
                    <div class="row input-field">
                        <i class="material-icons prefix">mail_outline</i>
                        <input type="email" class="validate" id="tbrmail" />
                        <label for="tbrmail">Emailadres</label>
                        <span class="helper-text" data-error="Vul a.u.b. een geldig emailadres in"></span>
                        <p class="red-text" id="mailhelper">Vul a.u.b. alle velden in</p>
                    </div>
                    <div class="center-align">
                        <button class="btn waves-effect orange" onclick="Login.cancelMail();">Annuleren</button>
                        <a href="#!" onclick="Login.sendmail();" class="btn green waves-effect ">Verzenden</a>
                    </div>
                </div>
            </div>
        </div>


    </div>

    

    <div id="tfarestore" class="modal">
        <div class="modal-content">
            <div class="row">
                <div class="center-align">
                    <h4>2FA uitschakelen</h4>
                    <h5>Type hier een van uw backupcodes in:</h5>
                    <div class="row">
                        <div class="input-field col s12 m4 offset-m4">
                            <input type="text" placeholder="Herstelcode" id="tfarest" />
                        </div>
                    </div>
                    <a href="#!" class="modal-close waves-effect red btn">Sluiten</a>
                    <a href="#!" class="waves-effect btn green" onclick="Login.restore2fa()">Verzenden</a>
                </div>
            </div>
        </div>
    </div>
</body>
<script>
let wrong2fa=0;var token="";let redirecturl="@Model",errorcnt=0;Login={init:function(){$("#_progbar").show(),$("#_reg, #_mreg").addClass("active"),$("#progbar2, #mailhelper").hide(),Login.mapEvents(),OverstagJS.General.restoreMe(Login.toggleWith,!0,Login.redirect)},mapEvents:function(){$("#Password").keydown((function(e){13==e.which&&Login.login()})),$("#Username").keydown((function(e){13==e.which&&$("#Password").focus()})),$("#lUsername").click((function(){$("#Username").focus()})),$("#lPassword").click((function(){$("#Password").focus()})),$("#btnlogin").click((function(){Login.login()})),$("#tbrmail").on("keyup",(function(){$("#mailhelper").hide()})),$("#sendmailreset").click((function(){""!=$("#tbrmail").val()?($("#mailhelper").hide(),Login.sendmail()):$("#mailhelper").show()})),$("#2facode").on("paste",(function(e){var text=e.originalEvent.clipboardData.getData("text");(null==text||null==text||text.length<1)&&(text=$("#2facode").val()),text.length>=6&&Login.validate2fa()})),$("#2facode").on("keyup",(function(){$("#2facode").val().length>=6&&Login.validate2fa()}))},sendmail:function(){$("#progbar2").show(),""!=$("#tbrmail").val()?$.post("/Register/postMailreset",{Email:$("#tbrmail").val()},(function(response){"success"==response.status?($("#tbrmail").val(""),M.toast({html:"Mail verzonden. Check je email a.u.b. <br><b>Controleer ook je spam map</b>",classes:"green "}),Login.cancelMail()):(M.toast({html:response.error,classes:"red "}),$("#tbrmail").val(""))}),"json").done((function(){$("#progbar2").hide(),M.Modal.getInstance($("#memailreset")).close()})):M.toast({html:"Vul a.u.b. alle velden in",classes:"orange"})},cancelMail:function(){$("#tbremail").val(""),$("#memailreset").hide(),$("#logincard").fadeIn("slow"),$("#Username").focus()},login:function(){var isValid=!0;$(".checki").each((function(){""==$.trim($(this).val())&&(isValid=!1)})),isValid?Login.post():M.toast({html:"Vul a.u.b. alle velden in",classes:"orange"})},toggleWith:function(enable){enable&&$("#logincard").fadeIn("slow"),Login.toggle(enable)},toggle:function(enable){enable?($("#_progbar").hide(),$("#lblmoment").hide(),$("#btnlogin").removeClass("disabled"),$("#Username").removeAttr("disabled"),$("#Password").removeAttr("disabled"),$("#Username").focus()):($("#btnlogin").addClass("disabled"),$("#Username").attr("disabled",!0),$("#Password").attr("disabled",!0),$("#_progbar").show())},post:function(){Login.toggle(!1),$.post("/Register/postLogin",{Username:$("#Username").val(),Password:$("#Password").val()},(function(response){"success"==response.status?(3==response.type&&localStorage.setItem("redirect","/Admin"),2==response.type&&localStorage.setItem("redirect","/Mentor"),"yes"==response.twofactor?(Login.open2fa(),$("#2facode").focus(),token=response.token):(Login.redirect(),localStorage.setItem("remember",response.remember))):(M.toast({html:response.error,classes:"red "}),$(".checki").val(""))}),"json").done((function(){Login.toggle(!0),$("#Username").focus()})).fail((function(){$("#_progbar").hide(),M.toast({html:"Inloggen mislukt door interne fout",classes:"red"})}))},redirect:function(){localStorage.setItem("login",!0),""==redirecturl?localStorage.getItem("redirect")?($(location).attr("href",localStorage.getItem("redirect")),localStorage.removeItem("redirect")):$(location).attr("href","/User"):$(location).attr("href",redirecturl)},open2fa:function(){$("#logincard").hide(),$("#2facard").fadeIn("slow"),$("#2facode").focus()},openMailReset:function(){$("#logincard").hide(),$("#memailreset").fadeIn("slow")},validate2fa:function(){if(6!=$("#2facode").val().length||isNaN($("#2facode").val()))M.toast({html:"Type aub een geldige code in",classes:"orange"}),$("#2facode").val("");else{var now=new Date,timestring=now.getDate().toString().padStart(2,"0")+"-"+(now.getMonth()+1).toString().padStart(2,"0")+"-"+now.getFullYear()+" "+now.getHours().toString().padStart(2,"0")+":"+now.getMinutes().toString().padStart(2,"0")+":"+now.getSeconds().toString().padStart(2,"0");$.post("/Register/Validate2FA",{token:token,code:$("#2facode").val(),datetime:timestring},(function(response){"success"==response.status?(localStorage.setItem("remember",response.remember),Login.cancel2fa(),Login.redirect()):"timeout"==response.status?M.toast({html:"Uw klok staat niet goed.",classes:"orange"}):(M.toast({html:"Validatie mislukt.",classes:"red"}),$("#2facode").val(""),wrong2fa++,wrong2fa>5&&(M.toast({html:"Te veel pogingen. Probeer het later opnieuw",classes:"orange"}),Login.cancel2fa()))}),"json").fail((function(){console.log("Er gaat iets fout"),errorcnt++,errorcnt>3&&M.toast({html:"Er is iets fout gegaan",classes:"red"})}))}},cancel2fa:function(){$("#Username").val(""),$("#Password").val(""),$("#2facode").val(""),$("#2facard").hide(),$("#logincard").fadeIn("slow"),$("#Username").focus()},restore2fa:function(){""==$("#tfarest").val()?M.toast({html:"Vul a.u.b. alle velden in!",classes:"orange"}):$.get("/Register/Restore2FA/"+token+"/"+encodeURIComponent($("#tfarest").val()),(function(r){"success"==r.status?(M.Modal.getInstance($("#tfarestore")).close(),Login.cancel2fa(),M.toast({html:"Code is juist. Log a.u.b. opnieuw in",classes:"green"})):M.toast({html:"Code onjuist",classes:"red"}),$("#tfarest").val("")}),"json").fail((function(){M.toast({html:"Er is iets fout gegaan",classes:"red"})}))}},Login.init(),$(document).ready((function(){$("input#2facode").characterCounter()}));
</script>

