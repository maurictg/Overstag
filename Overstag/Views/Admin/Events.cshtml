@model List<Overstag.Models.Event>
@{
    ViewData["Title"] = "Activiteiten";
    Layout = "/Views/_AdminLayout.cshtml";
    System.Globalization.CultureInfo culture = new System.Globalization.CultureInfo("nl-NL");    
}

<br />
<div id="eventsdiv" class="center-align">
    <h3 class="white-text">Activiteiten</h3>
    <br />
    <table class="table text-white">
        <thead>
            <tr>
                <th>Id</th>
                <th>Titel</th>
                <th>Omschrijving</th>
                <th>Datum</th>
                <th>Tijd</th>
                <th>Kosten</th>
                <th>Actie</th>
            </tr>
        </thead>
        <tbody>

            @foreach (var e in Model)
            {
                @if (!Overstag.Core.General.DateIsPassed(e.When))
                {
                    double c = (double)e.Cost;
                    <tr>
                        <td>@e.Id</td>
                        <td>@e.Title</td>
                        <td>@e.Description</td>
                        <td>@e.When.ToString("d", culture)</td>
                        <td>@e.When.ToString("t", culture)</td>
                        <td>&euro;@Math.Round(c / 100, 2).ToString("F")</td>
                        <td><a data-target="#verwijdermodal" data-toggle="modal"  onclick="eventtodelete = @e.Id">Verwijderen</a></td>
                    </tr>
                }
            }
        </tbody>
    </table>
    <h3 class="white-text">Activiteiten toevoegen</h3>
    <br />
    <form class="">
        <div class="input-group">
            <div class="input-group-append">
                &nbsp;<input type="text" class="checki form-control" id="ttitle" placeholder="Titel" />
                &nbsp;<input type="text" class="checki form-control" id="description" placeholder="Omschrijving" />
                &nbsp;<input type="text" class="checki form-control datepicker" id="date" placeholder="Datum">
                &nbsp;<input type="text" class="checki form-control timepicker" id="time" placeholder="Tijd">
                &nbsp;<input type="text" class="checki form-control" id="cost" placeholder="Kosten in eurocent" />
                &nbsp;
            </div>
            <div class="input-group-append">
                <input class="btn btn-primary" type="button" value="Toevoegen" id="btnadd">
            </div>
        </div>
    </form>

    <br />
    <h3 class="white-text">Ingeschreven deelnemers</h3>
    <br />
    <div id="participators" class="white-text">
        <!--Render deelnemers hier-->
    </div>

    <div class="modal fade" id="verwijdermodal" tabindex="-1" role="dialog" aria-labelledby="DeleteEvent"
    aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content bg-dark">
            <div class="modal-header">
                <h5 class="modal-title">Event verwijderen?</h5>
                <button type="button" class="close btn btn-warning" data-dismiss="modal" aria-label="Annuleren">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <h4>Weet u zeker dat u dit event wilt verwijderen?</h4>
                <p>Dit kan niet ongedaan worden gemaakt!</p>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" data-dismiss="modal">Annuleren</button>
                <button class="btn btn-danger" onclick="Events.delete(eventtodelete)">Verwijderen</button>
            </div>
        </div>
    </div>
</div>

</div>
<script>
    let eventtodelete = 0;
    Events = {
        init: function () {
            $('#_events').addClass('active');
            $('#progbar').hide();
            Events.mapEvents();
            $('#participators').load('/Admin/Participators');
        },
        mapEvents: function () {
             $('#btnadd').click(function () {
                 Events.post();
            });
        },
        post: function () {
            var data = {
                Title : $('#ttitle').val(),
                Description: $('#description').val(),
                When: $('#date').val() + ' ' + $('#time').val(),
                Cost : $('#cost').val()
            };
            $('#progbar').show();
            $.post("/Admin/postEvent",data , function (response) {
                if (response.status == 'success') {
                    location.reload();
                    $('.checki').val('');
                }
                else {
                    //status = error
                    M.toast({ html: response.error, classes: 'red' });
                }
                }, 'json'
            ).done(function(){
                $('#progbar').hide();
            });
        },
        delete: function (id) {
            //Post delete
            $.post("/Admin/deleteEvent/" + id, function (response) {
                if (response.status == 'success') {
                    location.reload();
                }
                else {
                    //status = error
                    M.toast({ html: response.error, classes: 'red' });
                }
            }, 'json').done(function () {
            });
        }
    }

    Events.init();
    //Comment: Misschien datetime library uit calvijn.ga gebruiken?
</script>