@model IEnumerable<Overstag.Models.Event>
@{
    ViewBag.Title = "Activiteiten";
}
<table class="responsive-table">
    <thead>
        <tr>
            <th>Wat</th>
            <th>Wanneer</th>
            <th>Omschrijving</th>
            <th>Kosten</th>
            <th>Meedoen?</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var e in Model)
        {
            if (!Overstag.Core.General.DateIsPassed(e.Date))
            {
                double c = (double)e.Cost;
                <tr>
                    <td>@e.Title</td>
                    <td>@Convert.ToDateTime(e.Date).ToLongDateString() om @Convert.ToDateTime(e.Time).ToShortTimeString()</td>
                    <td>@e.Description</td>
                    <td>&euro;@Math.Round(c / 100, 2).ToString("F")</td>
                    <td><a onclick="Events.subscribe(@e.Id);">Inschrijven</a></td>
                </tr>
            }
        }
    </tbody>
</table>
<script>
    var Events = {
        init: function () {
            $('#_events').addClass('active');
            $('#_mevents').addClass('active');
        },
        subscribe: async function (id) {
            if (!Overstag.loggedin) {
                localStorage.setItem("redirect", "/Home/Events");
                $(location).attr('href', '/Register');
            } else {
                //Inschrijven
                $.post("/User/postSubscribeEvent", { EventId: id }, function (response) {
                        if (response.status == 'success') {
                            M.toast({ html: 'Inschrijving gelukt! Leuk dat je komt!', classes: 'green' });
                            User.loadcontent();
                        }
                        else {
                            //status = error
                            M.toast({ html: response.error, classes: 'red' });
                        }
                    }, 'json');
            }
        }
    }

    Events.init();
</script>